<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Solicitud de Servicios</title>
    <style type="text/css">
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Lora:wght@400;500;600&display=swap');

    body {
        font-family: 'Roboto', sans-serif;
        line-height: 1.5;
        color: #333333;
        margin: 0;
        padding: 0 18px;
        font-size: 20pt; /* Antes 19pt */
        background-color: #ffffff;
    }

    .page {
        max-width: 820px;
        margin: 0 auto;
        position: relative;
        padding: 12px 20px;
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 2px solid #3c4858;
    }

    .header-left {
        width: 25%;
    }

    .header-center {
        width: 50%;
        text-align: center;
    }

    .header-right {
        width: 25%;
        text-align: right;
    }

    .logo {
        max-height: 65px;
    }

    .title {
        font-family: 'Lora', serif;
        font-size: 22pt;
        font-weight: 600;
        margin: 0 0 8px 0;
        color: #2c3e50;
        letter-spacing: 0.5px;
    }

    .subtitle {
        font-family: 'Lora', serif;
        font-size: 16pt;
        font-weight: 500;
        margin: 0;
        color: #546e7a;
        letter-spacing: 0.3px;
    }

    .info-grid {
        display: grid;
        grid-template-columns: 150px auto;
        column-gap: 16px;
        row-gap: 6px;
        margin-bottom: 14px;
    }

    .label {
        font-weight: 500;
        color: #455a64;
        letter-spacing: 0.3px;
        padding-right: 0 !important;
    }

    .section {
        margin-bottom: 10px;
        padding: 14px 20px;
        background-color: #fafafa;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        border-radius: 6px;
    }

    .section-title {
        font-family: 'Lora', serif;
        font-size: 15pt;
        font-weight: 600;
        border-bottom: 1.5px solid #607d8b;
        padding-bottom: 6px;
        margin-bottom: 14px;
        margin-top: 0;
        color: #37474f;
        letter-spacing: 0.4px;
    }

    .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 11pt;
        font-weight: 500;
        letter-spacing: 0.5px;
    }

    .badge-info { 
        background-color: #e3f2fd;
        color: #0d47a1;
    }

    .badge-warning { 
        background-color: #fff8e1;
        color: #ff6f00;
    }

    .service-list {
        list-style: none;
        padding-left: 0;
        margin: 0;
    }

    .service-item {
        margin-bottom: 5px;
        padding: 10px 15px;
        background-color: #ffffff;
        box-shadow: 0 1px 4px rgba(0,0,0,0.03);
        border-radius: 4px;
    }

    .service-item strong {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        font-size: 13pt;
        color: #2c3e50;
        letter-spacing: 0.3px;
    }

    .subservice-list {
        list-style: none;
        padding-left: 25px;
        margin: 2px 0 0;
    }

    .subservice-list li {
        padding: 3px 0;
        position: relative;
        padding-left: 18px;
        letter-spacing: 0.2px;
    }

    .subservice-list li::before {
        content: "•";
        position: absolute;
        left: 0;
        color: #607d8b;
        font-size: 15pt;
    }

    .recurrence-details {
        margin-top: 4px;
        padding: 15px;
        background-color: #ffffff;
        box-shadow: 0 1px 4px rgba(0,0,0,0.03);
        border-radius: 4px;
    }

    .subsection-title {
        font-family: 'Lora', serif;
        font-size: 14pt;
        margin-bottom: 15px;
        font-weight: 600;
        border-bottom: 1px solid #cfd8dc;
        padding-bottom: 8px;
        color: #455a64;
        letter-spacing: 0.3px;
    }

    .dates-section {
        margin-top: 20px;
    }

    .dates-section h4 {
        margin-bottom: 12px;
        font-size: 12pt; 
        font-weight: 500;
        color: #455a64;
        letter-spacing: 0.3px;
    }

    .dates-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        column-gap: 10px;
        row-gap: 6px;
        margin: 8px 0;
    }

    .date-item {
        padding: 6px 4px;
        background-color: #f5f5f5;
        text-align: center;
        font-size: 10.5pt;
        border-radius: 3px;
        letter-spacing: 0.3px;
    }

    .total-sessions {
        margin-top: 18px;
        font-size: 11pt;
        text-align: right;
        font-weight: 500;
        color: #37474f;
        letter-spacing: 0.2px;
    }

    .observations {
        padding: 15px;
        background-color: #ffffff;
        border-radius: 4px;
        line-height: 1.8;
        letter-spacing: 0.25px;
    }

    .observations p {
        margin: 0;
        padding: 0;
        color: #37474f;
    }

    .footer {
        margin-top: 12px;
        padding-top: 15px;
        border-top: 1.5px solid #cfd8dc;
        text-align: center;
    }

    .footer-content {
        font-size: 9pt;
        color: #607d8b;
        letter-spacing: 0.3px;
        line-height: 1.4;
    }

    .page-number:before { content: counter(page); }

    span {
        letter-spacing: 0.3px;
        padding-right: 15px;
    }


    @page {
        size: letter portrait;
        margin: 1.8cm;
    }

    @media print {
        body {
            margin: 0;
            padding: 0;
            color: #000;
            font-size: 10pt;
        }
        
        .section {
            page-break-inside: avoid;
            background-color: #fff;
            box-shadow: none;
            padding: 15px 0;
        }
        
        .service-item, 
        .recurrence-details, 
        .observations {
            background-color: #fff;
            box-shadow: none;
        }
        
        .date-item {
            background-color: #f9f9f9;
        }
        
        .badge-info { 
            background-color: #f0f7ff;
            color: #000;
        }
        
        .badge-warning { 
            background-color: #fffbf0;
            color: #000;
        }

        .section-title {
            color: #000;
        }
        
        .title, .subtitle {
            color: #000;
        }
        
        .label {
            color: #333;
        }
        
        .total-sessions {
            color: #000;
        }

        a {
            text-decoration: none;
            color: #000;
        }
    }
    </style>
</head>
<body>
    <div class="page">
        <div class="header">
            <div class="header-left">
                <img src="{{ url_for('static', filename='assets/img/logo.png') }}" alt="Logo" class="logo">
            </div>
            <div class="header-center">
                <h1 class="title">Solicitud de servicios</h1>
                <h2 class="subtitle">Departamento de Medialab</h2>
            </div>
            <div class="header-right">
                <img src="{{ url_for('static', filename='assets/img/medialab-logo.png') }}" alt="Medialab" class="logo">
            </div>
        </div>

        <!-- Información del Solicitante -->
        <div class="section">
            <h2 class="section-title">Información del Solicitante</h2>
            <div class="info-grid">
                <span class="label">Nombre:</span>
                <span>{{ data.get('applicant', 'N/A') }}</span>
                
                <span class="label">Email:</span>
                <span>{{ data.get('email', 'N/A') }}</span>
            </div>
            <div class="info-grid">
                <span class="label">Teléfono:</span>
                <span>{{ data.get('contact', 'N/A') }}</span>
                
                <span class="label">Empresa:</span>
                <span>{{ data.get('department', 'N/A') }}</span>
            </div>
        </div>

        <!-- Detalles de la Actividad -->
        <div class="section">
            <h2 class="section-title">Detalles de la Actividad</h2>
            <div class="info-grid">
                <span class="label">Nombre:</span>
                <span>{{ data.get('activity_name', 'N/A') }}</span>
                
                <span class="label">Ubicación:</span>
                <span>{{ data.get('activity_location', 'N/A') }}</span>
            </div>
            <div class="info-grid">
                <span class="label">Tipo:</span>
                <span class="badge {{ 'badge-warning' if data.get('product_opt') == 'recurrente' else 'badge-info' }}">
                    {{ 'Actividad Recurrente' if data.get('product_opt') == 'recurrente' else 'Actividad Única' }}
                </span>
            </div>
            <!-- Información de actividad única o recurrente -->
            {% if data.get('product_opt') == 'recurrente' %}
            <div class="recurrence-details">
                <h3 class="subsection-title">Patrón de Recurrencia</h3>
                <div class="info-grid">
                    <span class="label">Tipo:</span>
                    <span>{{ data.get('recurrenceType', 'N/A')|title }}</span>

                    {% if data.get('recurrenceType') == 'diario' %}
                    <span class="label">Frecuencia:</span>
                    <span>Todos los días</span>
                    {% endif %}

                    {% if data.get('recurrenceType') == 'semanal' %}
                    <span class="label">Días:</span>
                    <span>
                        {% for day in data.get('selectedWeekdays', []) %}
                            {{ day }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </span>
                    {% endif %}

                    {% if data.get('recurrenceType') == 'mensual' %}
                    <span class="label">Día del mes:</span>
                    <span>{{ data.get('selectedMonthDay', 'N/A') }}</span>
                    {% endif %}

                    <span class="label">Periodo:</span>
                    <span>Del {{ format_date(data.get('start_date'), 'full') }} al {{ format_date(data.get('end_date'), 'full') }}</span>

                    <span class="label">Horario:</span>
                    <span>{{ data.get('start', 'N/A') }} a {{ data.get('end', 'N/A') }}</span>
                </div>

                <div class="dates-section">
                    <h4>Fechas Programadas:</h4>
                    <div class="dates-grid">
                        {% if data.get('recurrenceType') == 'diario' %}
                            {% for date in get_daily_dates(data.get('start_date'), data.get('end_date')) %}
                                <div class="date-item">{{ format_date(date, 'short') }}</div>
                            {% endfor %}
                        {% endif %}

                        {% if data.get('recurrenceType') == 'semanal' %}
                            {% for date in get_weekly_dates(data.get('start_date'), data.get('end_date'), data.get('selectedWeekdays', [])) %}
                                <div class="date-item">{{ format_date(date, 'short') }}</div>
                            {% endfor %}
                        {% endif %}

                        {% if data.get('recurrenceType') == 'mensual' %}
                            {% for date in get_monthly_dates(data.get('start_date'), data.get('end_date'), data.get('selectedMonthDay')) %}
                                <div class="date-item">{{ format_date(date, 'short') }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>
                    
                    <p class="total-sessions">
                        <strong>Total de sesiones:</strong> 
                        {% if data.get('recurrenceType') == 'diario' %}
                            {{ get_daily_dates(data.get('start_date'), data.get('end_date'))|length }}
                        {% elif data.get('recurrenceType') == 'semanal' %}
                            {{ get_weekly_dates(data.get('start_date'), data.get('end_date'), data.get('selectedWeekdays', []))|length }}
                        {% elif data.get('recurrenceType') == 'mensual' %}
                            {{ get_monthly_dates(data.get('start_date'), data.get('end_date'), data.get('selectedMonthDay'))|length }}
                        {% endif %}
                    </p>
                </div>
            </div>
            {% else %}
            <div class="info-grid">
                <span class="label">Fecha:</span>
                <span>{{ format_date(data.get('start_date', 'N/A')) }}</span>
                
                <span class="label">Horario:</span>
                <span>{{ data.get('start', 'N/A') }} a {{ data.get('end', 'N/A') }}</span>
            </div>
            {% endif %}
        </div>

        <!-- Servicios Seleccionados -->
        <div class="section">
            <h2 class="section-title">Servicios Seleccionados</h2>
            {% if data.get('selectedMainServices') %}
            <ul class="service-list">
                {% for mainService in data.get('selectedMainServices', []) %}
                <li class="service-item">
                    <strong>{{ mainService }}</strong>
                    <ul class="subservice-list">
                        {% for subService in data.get('selectedSubServices', []) %}
                            {% if subService in subServiceOptions.get(mainService, []) %}
                                <li>{{ subService }}</li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p>No hay servicios seleccionados</p>
            {% endif %}
        </div>

        <!-- Observaciones -->
        {% if data.get('observations') or data.get('activity_details') %}
        <div class="section">
            <h2 class="section-title">Observaciones</h2>
            <div class="observations">
                <p>{{ data.get('observations', data.get('activity_details', 'Sin observaciones')) }}</p>
            </div>
        </div>
        {% endif %}

        <!-- Pie de página -->
        <div class="footer">
            <div class="footer-content">
                <p>
                    Documento generado el {{ now().strftime('%d/%m/%Y %H:%M') }} | 
                    Página <span class="page-number"></span>
                </p>
                <p>
                    ID: {{ data.get('id', 'N/A') }}
                </p>
            </div>
        </div>
    </div>
</body>
</html>